(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function a(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e.r(t);const i={xhr:!1,block:function(e){e&&e.length&&void 0!==jQuery.fn.block&&(e.addClass("ajax-blocked"),e.block({message:null,overlayCSS:{background:"#fff no-repeat center",opacity:.5,cursor:"none"}}))},unblock:function(e){e&&e.hasClass("ajax-blocked")&&void 0!==jQuery.fn.block&&(e.unblock(),e.removeClass("ajax-blocked"))},call:function(e,t,a){var o=this;return a=void 0!==a?a:"GET",Array.isArray(e)?(e.push({name:"action",value:yith_wcmv_ajax.ajaxAction}),e.push({name:"security",value:yith_wcmv_ajax.ajaxNonce}),e.push({name:"context",value:"admin"})):(e.action=yith_wcmv_ajax.ajaxAction,e.security=yith_wcmv_ajax.ajaxNonce,e.context="admin"),o.block(t),o.xhr=jQuery.ajax({url:yith_wcmv_ajax.ajaxUrl,data:e,type:a}).fail((function(e){console.log(e),o.unblock(t)})).done((function(e){o.unblock(t),o.xhr=!1})),o.xhr},get:function(e,t){return this.call(e,t,"GET")},post:function(e,t){return this.call(e,t,"POST")},abort:function(){this.xhr&&this.xhr.abort()}};new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"modal",void 0),o(this,"templateHeader",void 0),o(this,"templateContent",void 0),o(this,"templateFooter",void 0),o(this,"statusChanged",void 0),this.templateHeader=wp.template("yith-wcmv-modal-commission-header"),this.templateContent=wp.template("yith-wcmv-modal-commission-content"),this.templateFooter=wp.template("yith-wcmv-modal-commission-footer"),this.init()}var t,n,s;return t=e,(n=[{key:"init",value:function(){jQuery(document).on("click",".commission-details:not(.disabled)",{self:this},this.view),jQuery(document).on("change",".commission-details-modal #commission-status",this.statusChange.bind(this)),jQuery(document).on("click",".commission-details-modal .save-commission",{self:this},this.save),jQuery(document).on("change",".enable-gateway-trigger .on_off",this.enableGateway),jQuery(document).on("submit","form.gateway-options-form",this.gatewayFormSubmit),jQuery(document).on("click",".list-item.has-options .name > *",this.gatewaySlide)}},{key:"openModal",value:function(e){return void 0===this.templateHeader||void 0===this.templateContent||void 0===this.templateFooter?(console.error("Error loading commissions templates"),!1):void 0!==e&&void(this.modal=yith.ui.modal({title:this.templateHeader(e),content:this.templateContent(e),footer:this.templateFooter(e),classes:{wrap:"commission-details-modal"}}))}},{key:"view",value:function(e){e.preventDefault();var t=e.data.self,a=jQuery(this),o=a.data("commission_id"),n=a.data("commission-data");return void 0===n?(a.addClass("disabled"),i.abort(),i.call({request:"commission_details",commission_id:o},jQuery(this).closest("td")).done((function(e){a.removeClass("disabled"),e.success&&(a.data("commission-data",e.data),t.openModal(e.data))}))):t.openModal(n),!1}},{key:"statusChange",value:function(){this.statusChanged=!0}},{key:"save",value:function(e){e.preventDefault();var t=e.data.self;if(!0===t.statusChanged){var a=jQuery('[name="commission-status"]').val(),o=jQuery(this).attr("data-commission_id");i.post({request:"commission_change_status",commission_id:o,status:a},jQuery(".commission-details-modal .yith-plugin-fw__modal__main")).done((function(e){window.location.reload()}))}else t.modal.close()}},{key:"enableGateway",value:function(e){e.preventDefault();var t=jQuery(this),a=t.is(":checked");return t.attr("disabled","disabled"),i.call({request:"switch_gateway_enabled",gateway_id:t.data("gateway_id"),gateway_enabled:a?"yes":"no"},t.closest(".list-item")).done((function(e){t.removeAttr("disabled"),e.success||t.prop("checked",!a)})),!1}},{key:"gatewayFormSubmit",value:function(e){e.preventDefault();var t=jQuery(this).serializeArray();return t.push({name:"request",value:"save_gateway_options"}),i.call(t,jQuery(this).closest(".list-item"),"POST"),!1}},{key:"gatewaySlide",value:function(e){var t=jQuery(this).closest(".list-item");t.toggleClass("opened"),t.find(".options").slideToggle()}}])&&a(t.prototype,n),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}());var n=window;for(var s in t)n[s]=t[s];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();